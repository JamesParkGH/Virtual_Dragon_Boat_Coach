{% extends "base.html" %}

{% block content %}
<section class="feedback-section">
    <h1>Feedback Page</h1>
    <form action="/generate-graph" method="POST" id="feedbackForm">
        <div class="form-group">
            <label for="angle-name">Angle Name:</label>
            <select id="angle-name" name="angle_name" required>
                <option value="pelvis_tilt">Pelvis Tilt</option>
                <option value="pelvis_list">Pelvis List</option>
                <option value="pelvis_rotation">Pelvis Rotation</option>
                <option value="pelvis_tx">Pelvis TX</option>
                <option value="pelvis_ty">Pelvis TY</option>
                <option value="pelvis_tz">Pelvis TZ</option>
                <option value="hip_flexion_r">Hip Flexion Right</option>
                <option value="hip_adduction_r">Hip Adduction Right</option>
                <option value="hip_rotation_r">Hip Rotation Right</option>
                <option value="knee_angle_r">Knee Angle Right</option>
                <option value="ankle_angle_r">Ankle Angle Right</option>
                <option value="subtalar_angle_r">Subtalar Angle Right</option>
                <option value="mtp_angle_r">MTP Angle Right</option>
                <option value="hip_flexion_l">Hip Flexion Left</option>
                <option value="hip_adduction_l">Hip Adduction Left</option>
                <option value="hip_rotation_l">Hip Rotation Left</option>
                <option value="knee_angle_l">Knee Angle Left</option>
                <option value="ankle_angle_l">Ankle Angle Left</option>
                <option value="subtalar_angle_l">Subtalar Angle Left</option>
                <option value="mtp_angle_l">MTP Angle Left</option>
                <option value="lumbar_extension">Lumbar Extension</option>
                <option value="lumbar_bending">Lumbar Bending</option>
                <option value="lumbar_rotation">Lumbar Rotation</option>
                <option value="arm_flex_r">Arm Flex Right</option>
                <option value="arm_add_r">Arm Add Right</option>
                <option value="arm_rot_r">Arm Rot Right</option>
                <option value="elbow_flex_r">Elbow Flex Right</option>
                <option value="pro_sup_r">Pro Sup Right</option>
                <option value="arm_flex_l">Arm Flex Left</option>
                <option value="arm_add_l">Arm Add Left</option>
                <option value="arm_rot_l">Arm Rot Left</option>
                <option value="elbow_flex_l">Elbow Flex Left</option>
                <option value="pro_sup_l">Pro Sup Left</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Generate Graph</button>
    </form>
    <form action="/run-opensim" method="POST" id="opensimForm">
        <button type="submit" class="btn btn-secondary">Run Opensim</button>
    </form>

    {% if error %}
        <p class="alert alert-error">{{ error }}</p>
    {% endif %}

    {% if image_filename %}
        <div class="analysis-results">
            <h2>Technique Analysis Results</h2>
            <img src="{{ url_for('static', filename='Feedback/' ~ image_filename) }}" alt="Analysis Result Image" class="img-fluid">
        </div>
    {% endif %}

    <!-- Feedback Results -->
    {% if feedback %}
        <div class="feedback-results">
            <h2>Technique Feedback</h2>
            
            <!-- Top Arm Feedback -->
            <div class="feedback-category card">
                <div class="card-header">
                    <h3>Top Arm: {{ feedback.top_arm.rating }}</h3>
                </div>
                <div class="card-body">
                    <div class="main-points">
                        {% for point in feedback.top_arm.main_points %}
                            <p>{{ point }}</p>
                        {% endfor %}
                    </div>
                    
                    {% if feedback.top_arm.rating != 'Good' %}
                        <div class="improvement-points">
                            <h4>Improvement Points</h4>
                            
                            <h5>Limiting Factors:</h5>
                            <ul>
                                {% for factor in feedback.top_arm.improvement_points.limiting_factors %}
                                    <li>{{ factor }}</li>
                                {% endfor %}
                            </ul>
                            
                            <h5>Potential Injuries:</h5>
                            <ul>
                                {% for injury in feedback.top_arm.improvement_points.potential_injuries %}
                                    <li>{{ injury }}</li>
                                {% endfor %}
                            </ul>
                            
                            <h5>Technical Feedback:</h5>
                            <ul>
                                {% for tip in feedback.top_arm.improvement_points.technical_feedback %}
                                    <li>{{ tip }}</li>
                                {% endfor %}
                            </ul>
                            
                            <h5>Corrective Exercises:</h5>
                            <ul>
                                {% for exercise in feedback.top_arm.improvement_points.corrective_exercises %}
                                    <li>{{ exercise }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Bottom Arm Feedback -->
            <div class="feedback-category card">
                <div class="card-header">
                    <h3>Bottom Arm: {{ feedback.bottom_arm.rating }}</h3>
                </div>
                <div class="card-body">
                    <div class="main-points">
                        {% for point in feedback.bottom_arm.main_points %}
                            <p>{{ point }}</p>
                        {% endfor %}
                    </div>
                    
                    {% if feedback.bottom_arm.rating != 'Good' %}
                        <div class="improvement-points">
                            <h4>Improvement Points</h4>
                            
                            <h5>Limiting Factors:</h5>
                            <ul>
                                {% for factor in feedback.bottom_arm.improvement_points.limiting_factors %}
                                    <li>{{ factor }}</li>
                                {% endfor %}
                            </ul>
                            
                            <h5>Potential Injuries:</h5>
                            <ul>
                                {% for injury in feedback.bottom_arm.improvement_points.potential_injuries %}
                                    <li>{{ injury }}</li>
                                {% endfor %}
                            </ul>
                            
                            <h5>Technical Feedback:</h5>
                            <ul>
                                {% for tip in feedback.bottom_arm.improvement_points.technical_feedback %}
                                    <li>{{ tip }}</li>
                                {% endfor %}
                            </ul>
                            
                            <h5>Corrective Exercises:</h5>
                            <ul>
                                {% for exercise in feedback.bottom_arm.improvement_points.corrective_exercises %}
                                    <li>{{ exercise }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Posture Feedback -->
            <div class="feedback-category card">
                <div class="card-header">
                    <h3>Posture: {{ feedback.posture.rating }}</h3>
                </div>
                <div class="card-body">
                    <div class="main-points">
                        {% for point in feedback.posture.main_points %}
                            <p>{{ point }}</p>
                        {% endfor %}
                    </div>
                    
                    {% if feedback.posture.rating != 'Good' %}
                        <div class="improvement-points">
                            <h4>Improvement Points</h4>
                            
                            <h5>Limiting Factors:</h5>
                            <ul>
                                {% for factor in feedback.posture.improvement_points.limiting_factors %}
                                    <li>{{ factor }}</li>
                                {% endfor %}
                            </ul>
                            
                            <h5>Potential Injuries:</h5>
                            <ul>
                                {% for injury in feedback.posture.improvement_points.potential_injuries %}
                                    <li>{{ injury }}</li>
                                {% endfor %}
                            </ul>
                            
                            <h5>Technical Feedback:</h5>
                            <ul>
                                {% for tip in feedback.posture.improvement_points.technical_feedback %}
                                    <li>{{ tip }}</li>
                                {% endfor %}
                            </ul>
                            
                            <h5>Corrective Exercises:</h5>
                            <ul>
                                {% for exercise in feedback.posture.improvement_points.corrective_exercises %}
                                    <li>{{ exercise }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Paddle Angle Feedback -->
            <div class="feedback-category card">
                <div class="card-header">
                    <h3>Paddle Angle: {{ feedback.paddle_angle.rating }}</h3>
                </div>
                <div class="card-body">
                    <div class="main-points">
                        {% for point in feedback.paddle_angle.main_points %}
                            <p>{{ point }}</p>
                        {% endfor %}
                    </div>
                    
                    {% if feedback.paddle_angle.rating != 'Good' %}
                        <div class="improvement-points">
                            <h4>Improvement Points</h4>
                            
                            <h5>Limiting Factors:</h5>
                            <ul>
                                {% for factor in feedback.paddle_angle.improvement_points.limiting_factors %}
                                    <li>{{ factor }}</li>
                                {% endfor %}
                            </ul>
                            
                            {% if feedback.paddle_angle.improvement_points.potential_injuries %}
                                <h5>Potential Injuries:</h5>
                                <ul>
                                    {% for injury in feedback.paddle_angle.improvement_points.potential_injuries %}
                                        <li>{{ injury }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            
                            <h5>Technical Feedback:</h5>
                            <ul>
                                {% for tip in feedback.paddle_angle.improvement_points.technical_feedback %}
                                    <li>{{ tip }}</li>
                                {% endfor %}
                            </ul>
                            
                            <h5>Corrective Exercises:</h5>
                            <ul>
                                {% for exercise in feedback.paddle_angle.improvement_points.corrective_exercises %}
                                    <li>{{ exercise }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    {% endif %}
</section>
{% endblock %}